
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="theme-color" content="#60a5fa"/>
  <title>Sapporo Christmas</title>

  <!-- Preconnect for iOS Chrome -->
  https://cdn.tailwindcss.com
  https://unpkg.com
  https://cdn.jsdelivr.net

  <!-- Tailwind -->
  https://cdn.tailwindcss.com</script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            winter: {50:'#f0f8ff',100:'#e6f2ff',200:'#cfe6ff',300:'#a8d4ff',400:'#7cc0ff',
                     500:'#56acee',600:'#3a90d5',700:'#2e75ad',800:'#245f8d',900:'#1e4f76'}
          },
          boxShadow:{ soft:'0 12px 30px rgba(30,79,118,.18)', card:'0 8px 20px rgba(30,79,118,.14)'},
          borderRadius:{ pill:'32px' }
        }
      }
    }
  </script>

  <!-- Vue & Chart.js -->
  https://unpkg.com/vue@3/dist/vue.global.prod.js</script>
  https://cdn.jsdelivr.net/npm/chart.js</script>

  <style>
    :root { --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom); }
    html,body{height:100%}
    body{
      background:
        radial-gradient(1200px 600px at 50% -150px, rgba(255,255,255,.55), transparent 70%),
        linear-gradient(180deg, #e6f2ff 0%, #cfe6ff 20%, #a8d4ff 60%, #7cc0ff 100%);
      -webkit-font-smoothing: antialiased;
    }
    .bg-mount{position:fixed; inset:0; z-index:-1; opacity:.9;
      background-image:url('https://images.unsplash.com/photo-1549692520-acc6669e2f0c?q=80&w=1600&auto=format&fit=crop');
      background-size:cover; background-position:center; filter:blur(6px) saturate(105%);}
    .glass{background:rgba(255,255,255,.28); backdrop-filter:blur(16px) saturate(115%);}
    .glass-dark{background:rgba(31,78,110,.25); backdrop-filter:blur(16px) saturate(120%);}
    .tag-title{display:inline-block; padding:.35rem .7rem; border-radius:.75rem; background:#fff; box-shadow:0 6px 14px rgba(0,0,0,.08);}
    .hide-scroll::-webkit-scrollbar{display:none} .hide-scroll{scrollbar-width:none}
    .safe-top{padding-top:var(--safe-top)} .safe-bottom{padding-bottom:var(--safe-bottom)}
    /* Mobile frame: fits iPhone 13 mini (375px) & 16 Pro (~402px logical). */
    .frame{width:100vw; max-width:430px; margin:0 auto;}
  </style>
</head>
<body class="text-winter-900">
  <div class="bg-mount"></div>

  <div id="app" class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="safe-top">
      <div class="frame px-4 pt-2">
        <div class="flex items-center justify-between">
          <h1 class="text-lg font-semibold">Sapporo Christmas <span class="text-winter-600">â–²</span></h1>
          <div class="text-xs text-winter-800">1 JPY â‰ˆ {{ (1 / rateHKDperJPY).toFixed(3) }} HKD</div>
        </div>

        <!-- Day chips (è¡Œç¨‹) -->
        <div class="mt-3 flex items-center gap-2">
          <button class="rounded-xl px-3 py-2 text-sm font-medium shadow-card bg-white text-winter-800 border border-winter-200">
            è¡Œç¨‹
          </button>
          <div class="flex-1 overflow-x-auto hide-scroll">
            <div class="flex gap-2 min-w-max">
              <button v-for="d in days" :key="d.key"
                      @click="activeDayIndex=d.index"
                      class="px-3 py-2 rounded-2xl border text-sm font-medium transition"
                      :class="activeDayIndex===d.index?'bg-winter-600 text-white border-winter-600 shadow-soft':'bg-white/90 text-winter-900 border-winter-200 hover:bg-white'">
                <div class="text-[11px] opacity-80">Day {{ d.index+1 }}</div>
                <div class="font-semibold">{{ d.dateStr.slice(8,10) }}</div>
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Content -->
    <main class="flex-1 frame px-4 pb-32">

      <!-- è¡Œç¨‹ (Schedule) -->
      <section v-show="activeTab==='schedule'" class="mt-4 space-y-4">
        <!-- Sapporo Weather note -->
        <div class="glass-dark rounded-2xl text-white shadow-soft p-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <span class="text-base">â˜€ï¸</span>
              <div>
                <div class="text-sm font-semibold">æœ­å¹Œ Â· Day {{ activeDayIndex+1 }} Â· {{ activeDay.dateStr }}</div>
                <div class="text-xs opacity-90">{{ weatherText || 'å‚™è¨»å¤©æ°£ï¼šæ™´ / å¤šé›²ï¼ˆæœ­å¹Œï¼‰' }}</div>
              </div>
            </div>
            <button @click="promptWeather('æœ­å¹Œ')" class="text-xs bg-white/20 border border-white/30 px-2 py-1 rounded-lg">ç·¨è¼¯</button>
          </div>
        </div>

        <div class="flex items-center justify-between">
          <div class="tag-title text-winter-900 text-sm font-bold">è¡Œç¨‹å®‰æ’</div>
          <button @click="openQuickAdd('schedule')" class="px-3 py-1.5 rounded-xl bg-winter-600 text-white text-sm shadow-card">ï¼‹ æ–°å¢</button>
        </div>

        <!-- Events list -->
        <div class="space-y-2">
          <div v-for="ev in dayEvents" :key="ev.id"
               class="rounded-2xl bg-white/90 border border-winter-200 p-3 shadow-card">
            <div class="flex items-center justify-between">
              <div class="font-semibold">{{ ev.title }}</div>
              <button @click="removeEvent(ev.id)" class="text-xs rounded-lg bg-white border border-winter-300 px-2 py-1">åˆªé™¤</button>
            </div>
            <div class="text-xs text-winter-700 mt-1">{{ ev.start }} â†’ {{ ev.end }}</div>
          </div>
          <div v-if="!dayEvents.length" class="text-sm text-winter-800">å°šæœªæ–°å¢äº‹ä»¶ã€‚å¯åœ¨ä¸‹æ–¹é¸æ“‡æ™‚æ®µæˆ–ä½¿ç”¨ã€Œï¼‹ æ–°å¢ã€ã€‚</div>
        </div>

        <!-- Quick add -->
        <div class="rounded-2xl p-3 bg-white/85 border border-winter-200 shadow-card">
          <div class="grid grid-cols-3 gap-2 mb-2">
            <div>
              <label class="text-xs text-winter-700">æ™‚æ®µ</label>
              <select v-model="schedule.newEvent.start" class="mt-1 w-full rounded-lg border border-winter-200">
                <option v-for="t in timeSlots" :value="t">{{ t }}</option>
              </select>
            </div>
            <div>
              <label class="text-xs text-winter-700">æ™‚é•·</label>
              <select v-model.number="schedule.newEvent.durationMins" class="mt-1 w-full rounded-lg border border-winter-200">
                <option :value="30">30 åˆ†</option><option :value="60">60 åˆ†</option><option :value="90">90 åˆ†</option><option :value="120">120 åˆ†</option>
              </select>
            </div>
            <div>
              <label class="text-xs text-winter-700">æ¨™é¡Œ</label>
              <input v-model="schedule.newEvent.title" placeholder="ä¾‹å¦‚ï¼šé›ªç¥­" class="mt-1 w-full rounded-lg border border-winter-200"/>
            </div>
          </div>
          <div class="flex gap-2">
            <button @click="addEvent" class="flex-1 rounded-xl bg-winter-600 text-white py-2">åŠ å…¥è¡Œç¨‹</button>
            <button @click="clearDayEvents" class="rounded-xl bg-white border border-winter-300 px-3">æ¸…ç©ºç•¶æ—¥</button>
          </div>
        </div>
      </section>

      <!-- åœ°åœ– (Map Pins) -->
      <section v-show="activeTab==='map'" class="mt-6 space-y-4">
        <div class="flex items-center justify-between">
          <div class="tag-title text-winter-900 text-sm font-bold">åœ°åœ–</div>
          <button @click="openQuickAdd('map')" class="px-3 py-1.5 rounded-xl bg-winter-600 text-white text-sm shadow-card">ï¼‹ æ–°å¢</button>
        </div>

        <div class="space-y-3">
          <div v-for="p in map.pins" :key="p.id"
               class="rounded-2xl bg-white/90 border border-winter-200 p-3 shadow-card">
            <div class="flex items-center justify-between">
              <div>
                <div class="font-semibold">{{ p.name }}</div>
                <div class="text-xs text-winter-700">{{ p.category }} â€¢ {{ p.notes }}</div>
              </div>
              <button @click="removePin(p.id)" class="text-xs rounded-lg bg-white border border-winter-300 px-2 py-1">åˆªé™¤</button>
            </div>
            <div class="mt-2 grid grid-cols-2 gap-2">
              mapsSearchUrl(p)é–‹å•Ÿåœ°åœ–</a>
              mapsDirectionsUrl(p)å°èˆªï¼ˆæ­¥è¡Œï¼‰</a>
            </div>
          </div>
          <div v-if="!map.pins.length" class="text-sm text-winter-800">å°šæœªå»ºç«‹æ™¯é» / é¤å»³ï¼ˆæœ­å¹Œï¼‰ã€‚æŒ‰å³ä¸Šè§’ã€Œï¼‹ æ–°å¢ã€ã€‚</div>
        </div>

        <!-- Add pin -->
        <div class="rounded-2xl p-3 bg-white/85 border border-winter-200 shadow-card">
          <div class="grid grid-cols-1 gap-2">
            <input v-model="map.newPin.name" placeholder="åœ°é»åç¨±ï¼ˆä¾‹ï¼šæœ­å¹Œé›»è¦–å¡”ï¼‰" class="rounded-lg border border-winter-200"/>
            <input v-model="map.newPin.query" placeholder="æœå°‹å­—ä¸²æˆ–åœ°å€ï¼ˆä¾‹ï¼šSapporo, Hokkaido, Japanï¼‰" class="rounded-lg border border-winter-200"/>
            <div class="grid grid-cols-2 gap-2">
              <select v-model="map.newPin.category" class="rounded-lg border border-winter-200">
                <option>æ™¯é»</option><option>ç¾é£Ÿ</option><option>è³¼ç‰©</option><option>äº¤é€š</option>
              </select>
              <input v-model="map.newPin.notes" placeholder="å‚™è¨»ï¼ˆä¾‹ï¼šæ—¥è½è§€æ™¯ï¼‰" class="rounded-lg border border-winter-200"/>
            </div>
          </div>
          <div class="mt-2 flex gap-2">
            <button @click="addPin" class="flex-1 rounded-xl bg-winter-600 text-white py-2">åŠ å…¥æ¸…å–®</button>
            <button @click="clearPins" class="rounded-xl bg-white border border-winter-300 px-3">å…¨éƒ¨æ¸…é™¤</button>
          </div>
        </div>
      </section>

      <!-- è¨˜å¸³ (Budget) -->
      <section v-show="activeTab==='budget'" class="mt-6 space-y-4">
        <div class="tag-title text-winter-900 text-sm font-bold">æ—…è²»ç®¡ç†</div>

        <!-- Summary glass -->
        <div class="rounded-2xl p-5 shadow-soft glass-dark text-white">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-xs opacity-90">ç¸½æ”¯å‡ºï¼ˆHKDï¼‰</div>
              <div class="text-4xl font-bold leading-tight">$ {{ totalHKD.toFixed(0) }}</div>
              <div class="text-xs opacity-90">æ—¥å¹£ä¼°è¨ˆ Â¥ {{ totalJPY.toFixed(0) }}</div>
            </div>
            <div class="text-right">
              <div class="text-xs opacity-90">å‰©é¤˜é ç®—ï¼ˆHKDï¼‰</div>
              <div class="text-2xl font-bold">{{ remainingHKD.toFixed(0) }}</div>
              <div class="text-xs opacity-90">Â¥ {{ remainingJPY.toFixed(0) }}</div>
            </div>
          </div>

          <!-- method totals -->
          <div class="mt-4 border-t border-white/30 pt-3 grid grid-cols-2 gap-3 text-center">
            <div>
              <div class="text-xs opacity-90">ğŸ’µ ç¾é‡‘</div>
              <div class="text-xl font-bold">HKD {{ paidByMethod.cash.toFixed(0) }}</div>
              <div class="text-xs opacity-90">Â¥ {{ (paidByMethod.cash * rateJPYperHKD).toFixed(0) }}</div>
            </div>
            <div>
              <div class="text-xs opacity-90">ğŸ’³ ä¿¡ç”¨å¡</div>
              <div class="text-xl font-bold">HKD {{ paidByMethod.card.toFixed(0) }}</div>
              <div class="text-xs opacity-90">Â¥ {{ (paidByMethod.card * rateJPYperHKD).toFixed(0) }}</div>
            </div>
          </div>

          <!-- NEW: paid-by totals -->
          <div class="mt-4 border-t border-white/30 pt-3 grid grid-cols-3 gap-3 text-center">
            <div>
              <div class="text-xs opacity-90">Ariel æ”¯ä»˜</div>
              <div class="text-lg font-bold">HKD {{ paidByPerson.Ariel.toFixed(0) }}</div>
            </div>
            <div>
              <div class="text-xs opacity-90">Wilken æ”¯ä»˜</div>
              <div class="text-lg font-bold">HKD {{ paidByPerson.Wilken.toFixed(0) }}</div>
            </div>
            <div>
              <div class="text-xs opacity-90">é›™æ–¹ï¼ˆæ··åˆï¼‰</div>
              <div class="text-lg font-bold">HKD {{ paidByPerson.Both.toFixed(0) }}</div>
            </div>
          </div>
        </div>

        <!-- Controls + è¨˜ä¸€ç­† -->
        <div class="rounded-2xl p-3 bg-white/85 border border-winter-200 shadow-card">
          <div class="grid grid-cols-2 gap-2">
            <div>
              <label class="text-xs text-winter-700">é ç®—ï¼ˆHKDï¼‰</label>
              <input type="number" v-model.number="budget.limitHKD" class="mt-1 w-full rounded-lg border border-winter-200"/>
            </div>
            <div>
              <label class="text-xs text-winter-700">åŒ¯ç‡ï¼ˆJPYï¼HKDï¼‰</label>
              <input type="number" step="0.01" v-model.number="budget.rateJPYperHKD" class="mt-1 w-full rounded-lg border border-winter-200"/>
            </div>
          </div>
          <hr class="my-3 border-winter-200"/>
          <!-- è¨˜ä¸€ç­† -->
          <div class="grid grid-cols-1 gap-2">
            <input v-model="budget.newItem.desc" placeholder="æ”¯å‡ºèªªæ˜ï¼ˆä¾‹ï¼šæ‹‰éºµåˆé¤ï¼‰" class="rounded-lg border border-winter-200"/>
